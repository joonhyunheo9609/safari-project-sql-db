# .github/workflows/sql-runner.yml

name: SQLite Runner

on:
  workflow_dispatch:
    inputs:
      sql_query:
        required: true
        type: string

jobs:
  run-sql:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup SQLite
      run: |
        sudo apt-get install -y sqlite3
        mkdir -p results
    
    - name: Initialize DB
      run: |
        if [ ! -f database.db ]; then
          sqlite3 database.db << 'EOF'
          CREATE TABLE page_requests (
            id INTEGER PRIMARY KEY,
            title TEXT UNIQUE,
            status TEXT,
            priority TEXT
          );
        EOF
        fi
    
    - name: Run SQL
      run: |
        echo '${{ github.event.inputs.sql_query }}' > query.sql
        sqlite3 database.db < query.sql > results/query_result.json
        echo '{"result": "success"}' > results/query_result.json
    
    - name: Commit
      run: |
        git config user.name "GitHub Action"
        git config user.email "action@github.com"
        git add .
        git commit -m "SQL 실행" || exit 0
        git push
